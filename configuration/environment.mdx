---
title: "Environment Variables"
description: "Complete configuration reference for all components"
---

Complete reference for environment variables across all Sari Platform components.

## API Backend

### Required Variables

| Variable | Description | Example |
|----------|-------------|---------|
| `CLOUD_SQL_CONNECTION_NAME` | Cloud SQL instance connection | `project:me-central2:instance` |
| `DB_NAME` | PostgreSQL database name | `sari_production` |
| `DB_USER` | Database user | `app_user` |
| `GCP_PROJECT_ID` | Google Cloud project ID | `mobily-mcp-hub` |

### Optional Variables

| Variable | Default | Description |
|----------|---------|-------------|
| `PORT` | `8080` | Server port |
| `GCP_REGION` | `me-central2` | GCP region |
| `USE_SECRET_MANAGER` | `false` | Enable GCP Secret Manager |
| `CORS_ORIGINS` | `*` | Allowed CORS origins (comma-separated) |
| `REDIS_HOST` | - | Redis/Memorystore host IP |
| `REDIS_PORT` | `6379` | Redis port |
| `ENABLE_VECTOR_EMBEDDINGS` | `true` | Enable Vertex AI embeddings |
| `VERTEX_AI_REGION` | `us-central1` | Vertex AI region |
| `ENABLE_EMAIL_NOTIFICATIONS` | `true` | Enable email sending |
| `RESEND_API_KEY` | - | Resend email service API key |
| `RESEND_FROM_EMAIL` | `noreply@example.com` | Sender email address |
| `ENABLE_RATE_LIMIT_PUBSUB` | `true` | Enable Pub/Sub publishing |

### Secret Manager Secrets

When `USE_SECRET_MANAGER=true`:

| Secret Name | Description |
|-------------|-------------|
| `db-password` | PostgreSQL password |
| `redis-auth` | Redis authentication password |
| `firebase-service-account` | Firebase Admin SDK credentials (JSON) |

### Example .env File

```bash
# Database
CLOUD_SQL_CONNECTION_NAME=mobily-mcp-hub:me-central2:sari-db
DB_NAME=sari_production
DB_USER=app_user

# GCP
GCP_PROJECT_ID=mobily-mcp-hub
GCP_REGION=me-central2
USE_SECRET_MANAGER=true

# Redis
REDIS_HOST=10.0.0.3
REDIS_PORT=6379

# Features
ENABLE_VECTOR_EMBEDDINGS=true
VERTEX_AI_REGION=us-central1
ENABLE_EMAIL_NOTIFICATIONS=true
ENABLE_RATE_LIMIT_PUBSUB=true

# CORS (production)
CORS_ORIGINS=https://sari-console.web.app,https://sari-platform.com
```

---

## MCP Server

### Required Variables

| Variable | Description | Example |
|----------|-------------|---------|
| `VECTOR_SEARCH_API_URL` | Vector search endpoint | `https://backend.run.app/api/vector/search` |
| `OPENAPI_SPEC_URL` | Collections API base URL | `https://backend.run.app/api/collections` |
| `RATE_LIMIT_CONFIG_URL` | Rate limit config endpoint | `https://backend.run.app/api/rate-limits` |

### Optional Variables

| Variable | Default | Description |
|----------|---------|-------------|
| `MCP_TRANSPORT` | `sse` | Transport mode: `stdio`, `sse`, `http` |
| `MCP_HOST` | `0.0.0.0` | Server bind host |
| `MCP_PORT` | `8080` | Server port |
| `PROTOCOL_PATH` | `/sse` | SSE endpoint path |
| `RATE_LIMIT_ENABLED` | `false` | Enable rate limiting |
| `REDIS_HOST` | - | Redis host for caching |
| `REDIS_PORT` | `6379` | Redis port |
| `USE_PUBSUB_POLLING` | `false` | Enable Pub/Sub config polling |
| `POLL_INTERVAL_SECONDS` | `30` | Pub/Sub poll interval |
| `EXTERNAL_AUDIT_ENABLED` | `true` | Enable external audit logging |
| `AUDIT_API_URL` | - | Audit log endpoint |

### Example .env File

```bash
# Transport
MCP_TRANSPORT=sse
MCP_HOST=0.0.0.0
MCP_PORT=8080
PROTOCOL_PATH=/sse

# Backend APIs
VECTOR_SEARCH_API_URL=https://mcp-backend-xxx.me-central2.run.app/api/vector/search
OPENAPI_SPEC_URL=https://mcp-backend-xxx.me-central2.run.app/api/collections
RATE_LIMIT_CONFIG_URL=https://mcp-backend-xxx.me-central2.run.app/api/rate-limits
AUDIT_API_URL=https://mcp-backend-xxx.me-central2.run.app/api/audit

# Rate Limiting
RATE_LIMIT_ENABLED=true
USE_PUBSUB_POLLING=true
POLL_INTERVAL_SECONDS=30

# Redis
REDIS_HOST=10.0.0.3
REDIS_PORT=6379

# GCP
GCP_PROJECT_ID=mobily-mcp-hub
USE_SECRET_MANAGER=true
```

---

## Admin Console (Frontend)

<Note>
  All frontend environment variables must be prefixed with `VITE_`.
</Note>

### Required Variables

| Variable | Description | Example |
|----------|-------------|---------|
| `VITE_API_URL` | Backend API base URL | `https://backend.run.app` |
| `VITE_FIREBASE_API_KEY` | Firebase Web API key | `AIzaSy...` |
| `VITE_FIREBASE_AUTH_DOMAIN` | Firebase auth domain | `project.firebaseapp.com` |
| `VITE_FIREBASE_PROJECT_ID` | Firebase project ID | `mobily-mcp-hub` |

### Optional Variables

| Variable | Description |
|----------|-------------|
| `VITE_FIREBASE_STORAGE_BUCKET` | Firebase storage bucket |
| `VITE_FIREBASE_MESSAGING_SENDER_ID` | Firebase messaging sender ID |
| `VITE_FIREBASE_APP_ID` | Firebase app ID |

### Example .env File

```bash
# API
VITE_API_URL=https://mcp-backend-xxx.me-central2.run.app

# Firebase
VITE_FIREBASE_API_KEY=AIzaSyxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
VITE_FIREBASE_AUTH_DOMAIN=mobily-mcp-hub.firebaseapp.com
VITE_FIREBASE_PROJECT_ID=mobily-mcp-hub
VITE_FIREBASE_STORAGE_BUCKET=mobily-mcp-hub.appspot.com
VITE_FIREBASE_MESSAGING_SENDER_ID=123456789012
VITE_FIREBASE_APP_ID=1:123456789012:web:abcdef123456
```

---

## Cloud Run Environment

### gcloud CLI

```bash
gcloud run deploy mcp-backend \
  --set-env-vars="DB_NAME=sari_production,GCP_PROJECT_ID=mobily-mcp-hub" \
  --set-secrets="db-password=db-password:latest"
```

### Secret Manager Setup

```bash
# Create secrets
echo -n "your-db-password" | gcloud secrets create db-password --data-file=-
echo -n "your-redis-password" | gcloud secrets create redis-auth --data-file=-
gcloud secrets create firebase-service-account --data-file=firebase-credentials.json

# Grant access to Cloud Run service account
gcloud secrets add-iam-policy-binding db-password \
  --member="serviceAccount:xxx@xxx.iam.gserviceaccount.com" \
  --role="roles/secretmanager.secretAccessor"
```

---

## Environment Precedence

Configuration is resolved in this order:

1. **Environment Variables** (highest priority)
2. **Secret Manager** (if `USE_SECRET_MANAGER=true`)
3. **Default Values** (lowest priority)

```python
def get_secret(name, default=None):
    # 1. Check cache
    if name in _secret_cache:
        return _secret_cache[name]

    # 2. Try Secret Manager
    if USE_SECRET_MANAGER:
        try:
            secret = secret_manager_client.access_secret_version(...)
            _secret_cache[name] = secret.payload.data.decode()
            return _secret_cache[name]
        except Exception:
            pass

    # 3. Fall back to env var
    return os.environ.get(name, default)
```

---

## Development vs Production

| Setting | Development | Production |
|---------|-------------|------------|
| `USE_SECRET_MANAGER` | `false` | `true` |
| `CORS_ORIGINS` | `*` | Specific domains |
| `MCP_TRANSPORT` | `stdio` | `sse` |
| `RATE_LIMIT_ENABLED` | `false` | `true` |
| Database | Local/Cloud SQL | Cloud SQL |
| Redis | Local/None | Cloud Memorystore |
